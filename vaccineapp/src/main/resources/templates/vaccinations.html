<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách lịch tiêm</title>
    <link rel="stylesheet" href="/css/citizen-management.css">
    <script src="/js/updateStatus.js"></script>
</head>
<body>
	<div th:replace="~{header}"></div>
    <h1>Danh sách lịch tiêm</h1>
    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
    <!-- Form lọc -->
    <form method="get" action="/vaccinations">
        <label for="vaccineName">Tên vaccine:</label>
        <select id="vaccineName" name="vaccineName">
            <option value="" th:text="'Tất cả'" th:selected="${vaccineName == null or vaccineName == ''}">Tất cả</option>
            <th:block th:each="vaccine : ${vaccines}">
                <option th:value="${vaccine.name}" th:text="${vaccine.name}" th:selected="${vaccine.name == vaccineName}">
                    <!-- Tên vaccine -->
                </option>
            </th:block>
        </select>
        
        <label for="vaccinationDate">Ngày đăng ký:</label>
        <input type="date" id="vaccinationDate" name="vaccinationDate" th:value="${vaccinationDate != null ? vaccinationDate : ''}">

        <label for="status">Trạng thái:</label>
        <select id="status" name="status">
            <option value="" th:text="'Tất cả'" th:selected="${status == null or status == ''}">Tất cả</option>
            <option value="PENDING" th:selected="${status == 'PENDING'}">Chờ xử lý</option>
            <option value="COMPLETED" th:selected="${status == 'COMPLETED'}">Đã tiêm</option>
            <option value="CANCELLED" th:selected="${status == 'CANCELLED'}">Đã hủy</option>
        </select>

        <button type="submit">Lọc</button>
        <a href="/vaccinations" class="btn-reset">Xóa bộ lọc</a>
    </form>
    <!-- Hiển thị danh sách lịch tiêm -->
		<table>
		    <thead>
		        <tr>
		            <th>Tên công dân</th>
		            <th>Tên vaccine</th>
		            <th>Ngày đăng ký</th>
		            <th>Số điện thoại</th>
		            <th>Trạng thái</th>
		            <th>Hành động</th>
		        </tr>
		    </thead>
		    <tbody>
		        <tr th:each="vaccination : ${vaccinations}">
		            <td th:text="${vaccination.citizen.fullName}">Tên công dân</td>
		            <td th:text="${vaccination.vaccine.name}">Tên vaccine</td>
		            <td th:text="${vaccination.vaccinationDate.toString()}">Ngày đăng ký</td>
		            <td th:text="${vaccination.citizen.phoneNumber}">Số điện thoại</td>
		            <td th:text="${vaccination.status.getDisplayName()}">Trạng thái</td>
		            <td>
					    <form method="post" th:action="@{/updateStatus}">
					        <input type="hidden" name="vaccinationId" th:value="${vaccination.id}" />
					        <!-- Hiển thị các nút khi trạng thái là PENDING -->
					        <div th:if="${vaccination.status.name() == 'PENDING'}">
							    <button type="submit" class="btn btn-warning" name="action" value="COMPLETED">Đã tiêm</button>
							    <button type="submit" class="btn btn-danger" name="action" value="CANCELLED">Hủy</button>
							</div>
					    </form>
					</td>
		        </tr>s
		        <tr th:if="${#lists.isEmpty(vaccinations)}">
		            <td colspan="6" style="text-align:center;">Không có lịch tiêm nào phù hợp với bộ lọc</td>
		        </tr>
		    </tbody>
		</table>
	<div th:replace="~{footer}"></div>
</body>
</html>